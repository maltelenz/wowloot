{% extends 'base.html' %}

{% block title %} - {{ calculation.name }}{% endblock %}

{% block content %}
<div class="calculationmaincontent">
  <h1 class="calculation">Who Ows What after {{ calculation.name }}</h1>
  <table class="expensetable">
    <tr class="header">
      <td class="header">&nbsp;</td>
      <td class="header">Who paid?</td>
      <td class="header">Amount</td>
      <td class="header">Name (optional)</td>
      {% for person in calculation.involved.all %}
      <td class="header">{{ person.name }}</td>
      {% endfor %}
      <td class="headernew">
	<form action="{% url add_person calculation.id calculation.hashtag %}" method="post">
	  {% csrf_token %}
	  {{ addpersonform.name }}
	  <input type="submit" value="Add">
	</form>
      </td>
    </tr>
    {% for expense in ordered_expenses %}
    <tr class="{% cycle 'even' 'odd' %}">
      <td class="iconcolumn">
	<a href="{% url expense_delete calculation.id calculation.hashtag expense.id %}"><img src="{{STATIC_URL}}images/cross.png" alt="D" /></a>
	<a href="{% url expense_edit calculation.id calculation.hashtag expense.id %}"><img src="{{STATIC_URL}}images/pencil.png" alt="E" /></a>
      </td>
      <td>{{ expense.person.name }}</td>
      <td>{{ expense.amount }} {{ expense.currency.name }}</td>
      <td>{{ expense.name }}</td>
      {% for person in calculation.involved.all %}
      <td>{% if person in expense.benefactors.all %}
	<a href="{% url benefactor_delete calculation.id calculation.hashtag expense.id person.id %}">
	<img src="{{STATIC_URL}}images/tick.png" alt="x" />
	</a>
	{% else %}
	<a href="{% url benefactor_add calculation.id calculation.hashtag expense.id person.id %}">
	  -
	</a>
	{% endif %}
      </td>
      {% endfor %}
    </tr>
    {% endfor %}
    <form action="{{ request.get_full_path }}" method="post">
      {% csrf_token %}
      <tr class="tablenew">
	<td class="iconcolumn">
	  <img src="{{STATIC_URL}}images/{% if is_edit %}editgrey{% else %}addgrey{% endif %}.png" />
	</td>
	<td>
	  {{ form.person }}
	</td>
	<td>
	  {{ form.amount }}
	  {{ form.currency }}
	</td>
	<td>
	  {{ form.name }}
	</td>
	{% for person in calculation.involved.all %}
	<td>
	  {% if forloop.last %}
	  <input type="submit" value="save">
	  {% endif %}
	</td>
	{% endfor %}
      </tr>
    </form>
    <tr class="balance">
      <td colspan="4">Balance</td>
      {% for person in calculation.involved.all %}
      <td>
	{% for key, value in owing.items %}
	{% if key == person %}{{ value|floatformat:2 }}{% endif %}
	{% endfor %}
      </td>
      {% endfor %}
    </tr>
  </table>
</div>
{% endblock %}
